[
  {
    "objectID": "analysis/meta-geah/index.html",
    "href": "analysis/meta-geah/index.html",
    "title": "Survey on Gender Equality at Home",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n\nCode\nlibrary(here)\n\n\nhere() starts at /workspaces/report-iwd2024\n\n\n\n\nCode\nhere(\"data\", \"geah2020-2021-asiapacific.csv\") |&gt;\n  read_csv() |&gt;\n  janitor::clean_names() -&gt;\nall_data\n\n\nRows: 879 Columns: 8\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (6): Geography, Question Code, Question Text, Response Category, Respons...\ndbl (2): Year, Value\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n\nCode\nall_data |&gt;\n  filter(question_code == \"B.24\") |&gt;\n  # code hours as an ordered factor\n  mutate(\n    response_category = factor(response_category,\n      levels = c(\n        \"No time spent on these activities\",\n        \"Less than 1 hour\",\n        \"Between 1 and 2 hours\", \"Between 2 and 3 hours\",\n        \"Between 3 and 4 hours\", \"Between 4 and 5 hours\",\n        \"Between 5 and 7 hours\", \"Between 7 and 9 hours\",\n        \"Between 9 and 11 hours\", \n        \"More than 11hrs\"),\n      labels = c(\n        \"0\", \"&lt;1\", \"1-2\", \"2-3\", \"3-4\", \"4-5\", \"5-7\", \"7-9\", \"9-11\", \"&gt;11\")),\n    gender = str_to_sentence(gender)) |&gt;\n  filter(gender != \"combined\") |&gt;\n  write_csv(here(\"data\", \"geah2021-hrs-domestic-care.csv\")) -&gt;\nq_b24\n\n\n\n\nCode\n# first kee pcountries together\nggplot(q_b24) +\n  aes(x = geography, y = value, fill = response_category) +\n  geom_col() +\n  facet_wrap(vars(gender)) +\n  scale_fill_brewer(palette = \"RdBu\", direction = -1) +\n  scale_y_continuous(\n    breaks = seq(0, 100, by = 20),\n    labels = scales::label_number(suffix = \"%\")) +\n  coord_flip() +\n  theme_minimal() +\n  theme(\n    strip.text = element_text(face = \"bold\", hjust = 0)\n  ) +\n  labs(\n    x = NULL, y = \"% of respondents\",\n    fill = \"Hours/day\",\n    title = \"Domestic and care work (2021)\",\n    subtitle = str_wrap(q_b24$question_text[1], 120)) -&gt;\nplot_b24_bycountry\n\nggsave(here(\"out\", \"assets\", \"geah-bycountry.png\"), plot_b24_bycountry, bg = \"white\")\n\n\nSaving 7 x 5 in image\n\n\nCode\n# then keep gender comparisons together\n\nggplot(q_b24) +\n  aes(x = gender, y = value, fill = response_category) +\n  geom_col() +\n  facet_wrap(vars(geography)) +\n  scale_fill_brewer(palette = \"RdBu\", direction = -1) +\n  scale_y_continuous(\n    breaks = seq(0, 100, by = 20),\n    labels = scales::label_number(suffix = \"%\")) +\n  coord_flip() +\n  theme_minimal() +\n  theme(\n    strip.text = element_text(face = \"bold\", hjust = 0)\n  ) +\n  labs(\n    x = NULL, y = \"% of respondents\",\n    fill = \"Hours/day\",\n    title = \"Domestic and care work (2021)\",\n    subtitle = str_wrap(q_b24$question_text[1], 120)) -&gt;\nplot_b24_bygender\n\nggsave(here(\"out\", \"assets\", \"geah-bygender.png\"), plot_b24_bygender, bg = \"white\")\n\n\nSaving 7 x 5 in image"
  },
  {
    "objectID": "analysis/care-work/index.html",
    "href": "analysis/care-work/index.html",
    "title": "Untitled",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n\nCode\nlibrary(readxl)\nlibrary(here)\n\n\nhere() starts at /workspaces/report-iwd2024\n\n\n\nSDG Indicator 5.4.1\nProportion of time spent on unpaid domestic chores and care work, by sex, age and location (percent)\nWe’ll get the data from the SDG Global Database. They do have a SDG API, but I couldn’t get the data endpoint to work, so let’s work with a manual download instead:\n\n\nCode\nhere(\"data\", \"sdg-indicator-5-4-1.xlsx\") |&gt;\n  read_excel(sheet = \"Goal5\") |&gt;\n  janitor::clean_names() -&gt;\nall_data\n\n\n\n\nCode\nall_data |&gt;\n  select(starts_with(\"series\"), geo_area_name, time_period, time_detail, sex, age, location,\n    value) |&gt;\n  mutate(\n    age = fct(age, levels = c(\n      \"ALLAGE\", \"3+\", \"5+\", \"6+\", \"6-65\",\n      \"10+\", \"10-14\", \"12+\", \"12-14\", \"12-24\", \"14+\", \"15+\", \"15-24\", \"15-49\",\n      \"15-64\",  \"16+\", \"18+\", \"20+\", \"20-24\", \"20-64\", \"20-74\", \"25-34\",\n      \"25-44\", \"35-44\", \"45-54\", \"45-64\", \"55-64\", \"65+\", \"65-74\", \"75-84\",\n      \"85+\"\n    )),\n    location = fct(location),\n    sex = fct(sex),\n    value = as.numeric(value)) -&gt;\nall_data_tidy\n\n\nOkay, we have a bit of a mess of age groups. Let’s try to see which countries use which age groups:\n\n\nCode\nall_data_tidy |&gt;\n  select(geo_area_name, age) |&gt;\n  group_by(geo_area_name, age) |&gt;\n  count() |&gt;\n  ungroup() |&gt;\n  pivot_wider(names_from = c(age), values_from = c(n), values_fill = 0) |&gt;\n  write_csv(here(\"data\", \"sdg-age-groups.csv\"))\n\n\nOkay, nobody’s reporting ALLAGE. It looks like most do: 10+, 15+, 15-24, 25-44, 45-54, 55-64, 65+ (there are a few exceptions though). Thankfully, it doesn’t appear as if many countries switch age groups based on whether they’re breaking down further.\n\n\nCode\nall_data_tidy |&gt;\n  filter(age %in% c(\"10+\", \"15+\", \"15-24\", \"25-44\", \"45-54\", \"55-64\", \"65+\")) |&gt;\n  filter(geo_area_name == \"Australia\") |&gt;\n  pull(time_detail) |&gt;\n  unique()\n\n\n[1] \"2006\"      \"2020-2021\"\n\n\nCode\nall_data_tidy |&gt;\n  select(geo_area_name, time_detail) |&gt;\n  group_by(geo_area_name, time_detail) |&gt;\n  count() |&gt;\n  ungroup() |&gt;\n  pivot_wider(names_from = c(time_detail), values_from = c(n), values_fill = 0) |&gt;\n  write_csv(here(\"data\", \"sdg-time-groups.csv\"))\n\n\nIt looks like frequency is all over the place for this data. Let’s visualise it more clearly:\n\n\nCode\nall_data_tidy |&gt;\n  select(geo_area_name, time_detail) |&gt;\n  group_by(geo_area_name, time_detail) |&gt;\n  count() |&gt;\n  ungroup() |&gt;\n  # average out year ranges\n  separate(time_detail, c(\"start\", \"end\"), sep = \"-\", fill = \"right\") |&gt;\n  mutate(\n    start = as.numeric(start),\n    end = as.numeric(end),\n    year = if_else(\n      is.na(end),\n      start,\n      start + (end - start) / 2),\n    date = date_decimal(year)) |&gt;\n  select(-c(start, end, year)) |&gt;\n  # sort countries by total number of reports\n  group_by(geo_area_name) |&gt;\n  add_tally(name = \"n_obs\") |&gt;\n  mutate(country = paste0(geo_area_name, \": \", n_obs)) -&gt;\nreporting_frequencies\n\n\n\n\nCode\nggplot(reporting_frequencies) +\n  aes(\n    x = fct_reorder(.f = country, .x = n_obs),\n    y = date,\n    group = geo_area_name) +\n  geom_line(colour = \"grey\") +\n  geom_point(fill = \"#333333\", colour = \"white\", size = 2, shape = 21) +\n  coord_flip() +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    panel.grid.major.y = element_blank()) +\n  labs(\n    x = NULL, y = NULL,\n    title = \"How often do countries report on unpaid chores and work?\") -&gt;\nfreq_plot\n\nggsave(here(\"out\", \"assets\", \"freq-plot.png\"), height = 16, width = 9,\n  units = \"in\", bg = \"white\")"
  },
  {
    "objectID": "analysis/timeuse-india/index.html",
    "href": "analysis/timeuse-india/index.html",
    "title": "Time Use in India, 2019",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n\nCode\nlibrary(themes360info)\nlibrary(ggtext)\nlibrary(here)\n\n\nhere() starts at /workspaces/report-iwd2024"
  },
  {
    "objectID": "analysis/timeuse-india/index.html#gendered-differences",
    "href": "analysis/timeuse-india/index.html#gendered-differences",
    "title": "Time Use in India, 2019",
    "section": "Gendered differences",
    "text": "Gendered differences\nKnowing this, I’m interested in the twofold effect on unpaid domestic and care work: that (a) more women than men participate in it, and (b) that those who do spend more time doing it.\n\n\nCode\nall_data_bymeasure_manual |&gt;\n  select(activity, sex, area, percentage, minutes, share = pctshare_manual) |&gt;\n  filter(\n    area != \"all\",\n    sex != \"person\",\n    activity %in% c(\n      \"Unpaid domestic services for household members\",\n      \"Unpaid caregiving services for household members\")) |&gt;\n  arrange(sex) |&gt;\n  group_by(activity, area) |&gt;\n  summarise(across(where(is.numeric), \\(x) x[1] / x[2])) |&gt;\n  mutate(\n    activity_short = case_match(activity,\n      \"Unpaid domestic services for household members\"   ~ \"Domestic work\",\n      \"Unpaid caregiving services for household members\" ~ \"Care work\"),\n    facet_label = paste0(activity_short, \" in \", area, \" areas\"),\n    facet_ann = paste0(\n      \"Share of time&lt;br&gt;\",\n      '&lt;span style=\"font-size: 18pt; font-face: bold;\"&gt;',\n        round(share, 1), \"x&lt;/span&gt;\")) -&gt;\ngender_ratios\n\n\n`summarise()` has grouped output by 'activity'. You can override using the\n`.groups` argument.\n\n\n\n\nCode\ngender_ratios |&gt;\n  select(activity_short, activity, area, percentage, minutes, share) |&gt;\n  write_csv(here(\"data\", \"ratios-india2019.csv\"))\n\n\n\n\n\n\n\n\nAlthough the differences found from manually calculating table 3 are within the significant figures provided for table 3, they do start to multiply out when you start calculating ratios. For example, for Unpaid caregiving across all areas, the ratio of women’s percentage share is 3.48x when using the manually calculated percentage share figures but\n\n\n\n\n\nCode\nggplot(gender_ratios) +\n  geom_rect(\n    aes(xmin = 0, ymin = 0, xmax = percentage, ymax = minutes),\n    fill = \"orange\", alpha = 0.75) +\n  geom_rect(\n    aes(xmin = 0, ymin = 0, xmax = 1, ymax = 1),\n    fill = \"black\", alpha = 0.75) +\n  geom_richtext(\n    aes(x = percentage, y = minutes, label = facet_ann),\n    hjust = 1, nudge_x = -0.05, vjust = 1, nudge_y = -0.05,\n    label.colour = NA, fill = NA, family = \"Body 360info\") +\n  facet_wrap(vars(facet_label)) +\n  coord_fixed() +\n  scale_x_continuous(\n    labels = scales::label_number(suffix = \"x\")) +\n  scale_y_continuous(\n    labels = scales::label_number(suffix = \"x\")) +\n  theme_360(base_size = 18) +\n  theme(\n    strip.text = element_text(face = \"bold\", hjust = 0),\n    panel.grid.minor = element_blank(),\n    axis.title = element_text(face = \"plain\")) +\n  labs(\n    x = \"Girls and women were more likely to do...\",\n    y = \"Girls and women spent more time doing...\",\n    title = \"Unpaid work in the home across India\",\n    caption = paste(\n      \"**CHART:** James Goldie, 360info\",\n      \"**DATA:** Time Use Survey 2019\",\n      \"Ministry of Statistics and Programme Implementation, Indian Government\",\n      sep = \"&lt;br&gt;\"),\n    subtitle = paste(\n      \"Girls and women aged 6+ surveyed in India (n = 447,250) reported being **more likely**\",\n      \"than body and men to report doing unpaid domestic or care work in the house.\",\n      \" Those who did also reported **spending more time** doing it.\",\n      sep = \"&lt;br&gt;\")) -&gt;\nratio_plot\n\nsave_360plot(ratio_plot, here(\"out\", \"assets\", \"gender-ratios.png\"))"
  },
  {
    "objectID": "analysis/timeuse-hilda/index.html",
    "href": "analysis/timeuse-hilda/index.html",
    "title": "HILDA survey",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(hildareadR)\nlibrary(gganimate)\nlibrary(here)\n\nhilda_dir &lt;- here(\"data\", \"raw-hilda\")\n\n\n\n\n\n\n\n\nNote\n\n\n\nThe raw data underpinning this analysis is not version controlled. To reproduce the analysis, you must request permission from DSS and download it via the Australian Data Archive.\nRaw data should be downloaded as .dta files put directly into /data/raw-hilda (not in subfolders), keeping the names provided by ADA.\nIn order to ensure that respondent data is not accidentally leaked during the render process, chunk output is turned off for most chunks until the end; I recommend you run this analysis interactively.\nThe render process also checks to ensure all groups are of sufficient size before rendering outputs.\n\n\n\nExplore the data\nAlthough we’ll use the {hildareadR} package (by Sara and Sebastian Kalucza) to combine wave data and extract variables, it’s still instructive to open the files using {haven} ourselves so that we can look at the column labels and particularly to understand the types of answers available.\nThis code assumes that all of the files have been unzipped directly into here(\"data\", \"raw-hilda\"). If you’ve downloaded them from Dataverse and they’ve unzipped into separate folders by zip file, pull them back up to the parent folder.\n\n\nCode\nhere(hilda_dir, \"Rperson_v220c.dta\") |&gt;\n  haven::read_dta() -&gt;\nall_lastwave\n\n# expand columns labels out so we can decide which id columns to use\ntibble(\n  name = names(all_lastwave),\n  question = map_chr(all_lastwave, ~ attr(.x, \"label\")),\n  answers = map(all_lastwave, ~ attr(.x, \"labels\"))) |&gt;\n  unnest_longer(answers)\n\n\n\n\nLoad the data\nVariable names in HILDA:\n\nstart with the wave identifier (a through v)\nend with number from 1 to 20 corresponding to the person the interviewee is referring to (since once person responds on behalf of their household)\n\n\n\nCode\nsurvey_vars &lt;- tribble(\n  ~ short, ~ long,\n  \"lsmnhw\", \"Minutes per week - Housework\",\n    \"lsmncar\", \"Minutes per week - Caring for disabled spouse/relative\",\n    \"lsmnerr\", \"Minutes per week - Household errands\",\n    \"lsmnhw\", \"Minutes per week - Housework\",\n    \"lsmnocd\", \"Minutes per week - Looking after other children\",\n    \"lshrcar\", \"Hours per week - Caring for disabled spouse/relative\",\n    \"lshrchd\", \"Hours per week - Playing with your children\",\n    \"lshrerr\", \"Hours per week - Household errands\",\n    #  'such as shopping, banking, paying bills, and keeping financial records (but do not include driving children to school and to other activities)'\n    \"lshrhw\", \"Hours per week - Housework\",\n    # 'such as preparing meals, washing dishes, cleaning house, washing clothes, ironing and sewing'\n    \"lshrocd\", \"Hours per week - Looking after other children\",\n    \"lshrod\", \"Hours per week - Outdoor tasks\",\n    # 'including home maintenance (repairs, improvements, painting etc.), car maintenance or repairs and gardening'\n  \"lscar\", \"Combined - Caring for disabled spouse/relative\",\n  \"lschd\", \"Combined - Playing with your children\",\n  \"lscom\", \"Combined - Travelling to/from paid employment\",\n  \"lsemp\", \"Combined - Paid employment\",\n  \"lserr\", \"Combined - Household errands\",\n  \"lshw\", \"Combined - Housework\",\n  \"lsocd\", \"Combined - Playing with other peoples children\",\n  \"lsod\", \"Combined - Outdoor tasks\",\n  \"lsvol\", \"Combined - Volunteer/Charity work\",\n)\n\nall_lastwave |&gt;\n  select(ends_with(survey_vars$short)) -&gt;\ntimeobs\n\nattr(all_lastwave$vhhstate, \"labels\")\n\n\nThe {hildareadR} package saves us a lot of the work of combining waves and selecting out variables of interest, as it handles the wave prefixes (although it is instructive to open the files in {haven} manually).\nThe variables of interest around hours/minutes per week spent on various activities all relate to the reporting person’s file. So we don’t need hgageNN and hgsexNN, which relate to other people in the household — we just need hgage and hgsex, which related to the person doing the reporting.\n\n\nCode\nread_hilda(\n  c(\"hgsex\", \"hgage\", survey_vars$short),\n  waves = 1:22, dir = hilda_dir, release = 22) |&gt;\n  select(\n    -contains(paste0(\"hgage\", 1:20)),\n    -contains(paste0(\"hgsex\", 1:20))) |&gt;\n  select(xwaveid, wave, hgage, hgsex, everything()) -&gt;\nall_data\n\n\nLet’s first see how much missing data there is. There is formally missing data in R’s sense (NA), but this survey has also been coded such that negative numbers refer to various error codes (eg. “Did not know”). I’m going to collapse those down as missing too.\n\n\nCode\nall_data |&gt;\n  filter(hgage &gt;= 0, hgsex &gt;= 0) |&gt;\n  # replace negative values with NA\n  mutate(across(starts_with(\"ls\"), ~ case_when(.x &lt; 0 ~ NA, TRUE ~ .x))) |&gt;\n  summarise(across(\n    where(is.numeric),\n    ~ length(which(is.na(.x))) / length(.x))) |&gt;\n  t()\n\n\n             [,1]\nhgage   0.0000000\nhgsex   0.0000000\nhgagef  0.0000000\nlshrerr 0.3570739\nlshrhw  0.3500212\nlshrod  0.3556669\nlshrchd 0.3782936\nlshrcar 0.3934411\nlsmnerr 0.3848165\nlsmnhw  0.3777923\nlshrocd 0.4235931\nlsmnocd 0.4235909\nlsmncar 0.4207043\nlsemp   0.3841965\nlscom   0.3925507\nlserr   0.3848209\nlshw    0.3777945\nlsod    0.3833655\nlschd   0.4055349\nlsocd   0.4235931\nlsvol   0.4139858\nlscar   0.4207043\nlscarb  0.8969597\nlscarmn 0.8969246\n\n\nLooks like reporting age and sex are all there. For most other variables, around 35–45% of the data are missing.\nFor lscarb and lscarmn, nearly 90% are missing. I’m not entirely sure what they are — there’s also lsmncar (caring minutes) and lscar (caring mins/hrs combined), so they must be something else (or perhaps a coding error - they don’t appear in the data dictionary). Let’s drop them.\nFor the remaining columns, I’d like to see if the missing data is concentrated in any age/sex/wave group:\n\n\nCode\nall_data |&gt;\n  select(-hgagef, -lscarb, -lscarmn) |&gt;\n  filter(hgage &gt;= 0, hgsex &gt;= 0) |&gt;\n  # replace negative values with NA\n  mutate(across(starts_with(\"ls\"), ~ case_when(.x &lt; 0 ~ NA, TRUE ~ .x))) |&gt;\n  mutate(age_group = cut(hgage, c(-Inf, 15, 25, 35, 45, 55, 65, 75, 85, Inf))) |&gt;\n  select(xwaveid, wave, hgsex, age_group, hgage, everything()) |&gt;\n  group_by(wave, hgsex, age_group) |&gt;\n  summarise(across(starts_with(\"ls\"), list(\n    nobs = ~ length(.x),\n    pct_miss = ~ length(which(is.na(.x))) / length(.x)))) |&gt;\n  ungroup() -&gt;\ngrouped_missing_stats\n\n\n\n\nCode\ngrouped_missing_stats |&gt;\n  select(wave, hgsex, age_group, ends_with(\"pct_miss\")) |&gt;\n  mutate(group = paste(wave, hgsex, age_group)) |&gt;\n  pivot_longer(ends_with(\"pct_miss\"), names_to = \"measure\") |&gt;\n  ggplot() +\n    aes(y = group, x = measure, fill = value) +\n    geom_tile() +\n    scale_fill_distiller(palette = \"YlOrRd\")\n\n\n\n\n\nOkay, this is too much to look at as one figure. Let’s look at it wave by wave:\n\n\nCode\ngrouped_missing_stats |&gt;\n  select(wave, hgsex, age_group, ends_with(\"pct_miss\")) |&gt;\n  mutate(group = paste(wave, hgsex, age_group)) |&gt;\n  pivot_longer(ends_with(\"pct_miss\"), names_to = \"measure\") |&gt;\n  filter(wave == \"u\") |&gt;\n  ggplot() +\n    aes(y = group, x = measure, fill = value) +\n    geom_tile() +\n    scale_fill_distiller(palette = \"YlOrRd\")\n\n\n\n\n\nMuch better. If we look through the 20 or so waves by altering the filter, we can see there’s a lot of missing data in the 0-15s. That makes sense; I’m kind of surprised there are many of them answering the survey at all. I’ll cut the 0-15s.\nGroup numbers start to tail off in the 75-80 bracket. They’re not small enough to worry about identification (provided we don’t disaggregate any further) — in the realm of a few dozen people per group — but I might cut the 75-85 bucket and just look at 75+ to be safe.\nNow let’s start actually looking at stats around time spent on various activities. I still need to resolve the “combined” hours/minutes spent measures.\n\n\nCode\nall_data |&gt;\n  select(-hgagef, -lscarb, -lscarmn) |&gt;\n  filter(hgage &gt;= 0, hgsex &gt;= 0) |&gt;\n  # replace negative time-spent values with NA\n  mutate(across(starts_with(\"ls\"), ~ case_when(.x &lt; 0 ~ NA, TRUE ~ .x))) |&gt;\n  mutate(age_group = cut(hgage, c(15, 25, 35, 45, 55, 65, 75, Inf))) |&gt;\n  filter(!is.na(age_group), wave != \"a\") |&gt;\n  select(xwaveid, wave, hgsex, age_group, hgage, everything()) -&gt;\nrefined_groups\n\nrefined_groups |&gt;\n  group_by(wave, hgsex, age_group) |&gt;\n  summarise(across(starts_with(\"ls\"), list(\n    nobs = ~ length(.x),\n    p10 = ~ quantile(.x, 0.1, na.rm = TRUE),\n    q1 = ~ quantile(.x, 0.25, na.rm = TRUE),\n    mean = ~ mean(.x, na.rm = TRUE),\n    median = ~ median(.x, na.rm = TRUE),\n    q3 = ~ quantile(.x, 0.75, na.rm = TRUE),\n    p90 = ~ quantile(.x, 0.9, na.rm = TRUE)\n    ))) -&gt;\ngrouped_stats\n\n\nNow let’s visualise the stats. Along the way, we’ll confirm there none of the groups have gotten too small:\n\n\nCode\nsurvey_vars |&gt;\n  pull(long) |&gt;\n  set_names(survey_vars$short) -&gt;\nsurvey_mappings\n\ngrouped_stats |&gt;\n  ungroup() |&gt;\n  pivot_longer(\n    -c(wave, hgsex, age_group),\n    names_to = c(\"activity\", \"statistic\"),\n    names_sep = \"_\",\n    values_to = \"value\") |&gt;\n  # recode the values\n  mutate(\n    sex = case_match(hgsex, 1 ~ \"Male\", 2 ~ \"Female\"),\n    wave_num = match(wave, letters),\n    year = wave_num + 2000,\n    activity_long = str_replace_all(activity, survey_mappings),\n    statistic = case_match(statistic,\n      \"nobs\" ~ \"Number of people\",\n      \"p10\" ~ \"10th percentile\",\n      \"q1\" ~ \"25th percentile\",\n      \"mean\" ~ \"Average\",\n      \"median\" ~ \"Median\",\n      \"q3\" ~ \"75th percentile\",\n      \"p90\" ~ \"90th percentile\")) |&gt;\n    separate(activity_long, into = c(\"units\", \"activity_long\"), sep = \" - \") |&gt;\n  select(year, sex, age_group, activity, units, activity_long, statistic, value) -&gt;\ngrouped_stats_recoded\n\ngrouped_stats_recoded |&gt;\n  filter(statistic == \"Number of people\") |&gt;\n  pull(value) |&gt;\n  min() -&gt;\nmin_group_size\n\nif (min_group_size &lt; 30) {\n  stop(paste(\n    \"Error: minimum group size too small to produce outputs while preserving\",\n    \"privacy of respondants. Checking groupings in analysis code.\"))\n}\n# start with hrs vars\ngrouped_stats_recoded |&gt;\n  filter(units == \"Hours per week\", statistic == \"Average\") |&gt;\n  ggplot() +\n    aes(x = age_group, y = value, fill = activity_long) +\n    geom_col() +\n    facet_grid(vars(year), vars(sex)) +\n    scale_fill_brewer(type = \"qual\") +\n    theme(\n      legend.position = \"top\",\n      legend.direction = \"horizontal\")\n\n\n\n\n\nThis is a good start, and it’s already clear that there are big gender discrepancies in terms of tasks like Housework and Playing with your children. It might work better animating the waves, rather than facetting them:\n\n\nCode\ngrouped_stats_recoded |&gt;\n  filter(units == \"Hours per week\", statistic == \"Average\") |&gt;\n  ggplot() +\n    aes(x = age_group, y = value, fill = activity_long) +\n    geom_col() +\n    facet_wrap(vars(sex), ncol = 2) +\n    transition_time(year) +\n    enter_fade() +\n    exit_fade() +\n    ease_aes(\"sine-in-out\") +\n    scale_fill_brewer(type = \"qual\") +\n    theme(\n      legend.position = \"top\",\n      legend.direction = \"horizontal\") +\n    labs(\n      title = \"Hours per week: {floor(frame_time)}\"\n    ) -&gt;\nani_hrsweek_mean\n\nanim_save(\"ani_hrsweek_mean.mp4\",\n  ani_hrsweek_mean,\n  path = here(\"out\", \"assets\"),\n  renderer = ffmpeg_renderer())\n\n\n\n\n\n{{ video /assets/ani_hrsweek_mean.mp4 }}\n\n\nFigure 1: Animation: hours spent per week on unpaid domestic and care work, broken down by activity, age group, sex and year\n\n\n\nWe could also look at this using the various quantiles we have computed, but that might be easier to do interactively. Let’s write the data out and do the chart in a separate doc.\n\n\nCode\ngrouped_stats_recoded |&gt;\n  filter(\n    units == \"Combined\",\n    statistic %in% c(\"Number of people\", \"Average\")) |&gt;\n  pivot_wider(names_from = statistic, values_from = value) |&gt;\n  write_csv(here(\"data\", \"hilda-unpaid-time-stats.csv\"))"
  }
]